<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯¾ç¨‹è¯¦æƒ… -->
  <view class="course-detail" wx:elif="{{course}}">
    
    <!-- è¯¾ç¨‹çŠ¶æ€å¡ç‰‡ -->
    <view class="status-card status-{{course.statusClass}}">
      <view class="status-header">
        <view class="status-icon">
          <text wx:if="{{course.status === 'scheduled'}}">ğŸ“…</text>
          <text wx:elif="{{course.status === 'ongoing'}}">â°</text>
          <text wx:elif="{{course.status === 'completed'}}">âœ…</text>
          <text wx:else>âŒ</text>
        </view>
        <view class="status-text">{{course.statusText}}</view>
      </view>
      
      <view class="status-tip" wx:if="{{course.isUpcoming}}">
        <text>å³å°†å¼€å§‹çš„è¯¾ç¨‹</text>
      </view>
      <view class="status-tip" wx:elif="{{course.isOngoing}}">
        <text>è¯¾ç¨‹æ­£åœ¨è¿›è¡Œä¸­</text>
      </view>
      <view class="status-tip" wx:elif="{{course.isPast}}">
        <text>è¯¾ç¨‹å·²ç»“æŸ</text>
      </view>
    </view>

    <!-- æ—¶é—´ä¿¡æ¯ -->
    <view class="info-section">
      <view class="section-title">æ—¶é—´å®‰æ’</view>
      <view class="time-info">
        <view class="time-row">
          <view class="time-label">æ—¥æœŸ</view>
          <view class="time-value">{{course.dateText}} ({{course.dayText}})</view>
        </view>
        <view class="time-row">
          <view class="time-label">æ—¶é—´</view>
          <view class="time-value">{{course.timeText}}</view>
        </view>
        <view class="time-row">
          <view class="time-label">æ—¶é•¿</view>
          <view class="time-value">{{course.durationText}}</view>
        </view>
      </view>
    </view>

    <!-- å¯¹æ–¹ä¿¡æ¯ -->
    <view class="info-section">
      <view class="section-title">{{userType === 'coach' ? 'å­¦å‘˜' : 'æ•™ç»ƒ'}}ä¿¡æ¯</view>
      <view class="user-info" bindtap="onContactOther">
        <image class="user-avatar" src="{{course.otherUser.avatar}}" mode="aspectFill"></image>
        <view class="user-details">
          <text class="user-name">{{course.otherUser.nickname}}</text>
          <text class="user-phone" wx:if="{{course.otherUser.phone}}">{{course.otherUser.phone}}</text>
          <view class="user-tags" wx:if="{{course.otherUser.specialty}}">
            <text class="tag" wx:for="{{course.otherUser.specialty}}" wx:key="*this">{{item}}</text>
          </view>
        </view>
        <view class="contact-icon">></view>
      </view>
    </view>

    <!-- åœ°ç‚¹ä¿¡æ¯ -->
    <view class="info-section" wx:if="{{course.location}}">
      <view class="section-title">ä¸Šè¯¾åœ°ç‚¹</view>
      <view class="location-info" bindtap="onViewLocation">
        <view class="location-icon">ğŸ“</view>
        <text class="location-text">{{course.location}}</text>
        <view class="location-action">æŸ¥çœ‹åœ°å›¾</view>
      </view>
    </view>

    <!-- å¤‡æ³¨ä¿¡æ¯ -->
    <view class="info-section" wx:if="{{course.remark}}">
      <view class="section-title">å¤‡æ³¨è¯´æ˜</view>
      <view class="remark-content">
        <text>{{course.remark}}</text>
      </view>
    </view>

    <!-- è¯¾ç¨‹è®°å½• -->
    <view class="info-section" wx:if="{{course.status === 'completed'}}">
      <view class="section-title">è¯¾ç¨‹è®°å½•</view>
      <view class="course-record">
        <view class="record-item">
          <text class="record-label">å®Œæˆæ—¶é—´</text>
          <text class="record-value">{{course.dateText}} {{course.timeText}}</text>
        </view>
        <view class="record-item" wx:if="{{course.actualDuration}}">
          <text class="record-label">å®é™…æ—¶é•¿</text>
          <text class="record-value">{{course.actualDuration}}åˆ†é’Ÿ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section" wx:if="{{course && course.status !== 'cancelled'}}">
    <!-- å³å°†å¼€å§‹çš„è¯¾ç¨‹æ“ä½œ -->
    <view wx:if="{{course.isUpcoming}}">
      <button 
        class="btn btn-outline btn-block" 
        wx:if="{{course.canReschedule}}"
        bindtap="onRescheduleCourse"
      >
        ç”³è¯·æ”¹æœŸ
      </button>
      
      <button 
        class="btn btn-danger btn-block {{operating ? 'btn-disabled' : ''}}" 
        wx:if="{{course.canCancel}}"
        bindtap="onCancelCourse"
        loading="{{operating}}"
      >
        {{operating ? 'å–æ¶ˆä¸­...' : 'å–æ¶ˆè¯¾ç¨‹'}}
      </button>
      
      <view class="action-tips" wx:if="{{!course.canCancel && !course.canReschedule}}">
        <text>âš ï¸ è¯¾ç¨‹å¼€å§‹å‰2å°æ—¶å†…ä¸å¯å–æ¶ˆæˆ–æ”¹æœŸ</text>
      </view>
    </view>

    <!-- è¿›è¡Œä¸­çš„è¯¾ç¨‹æ“ä½œ -->
    <view wx:elif="{{course.isOngoing}}">
      <button class="btn btn-primary btn-block">
        è¯¾ç¨‹è¿›è¡Œä¸­
      </button>
    </view>

    <!-- å·²å®Œæˆçš„è¯¾ç¨‹æ“ä½œ -->
    <view wx:elif="{{course.isPast && course.status !== 'completed'}}">
      <button class="btn btn-outline btn-block">
        æ ‡è®°ä¸ºå·²å®Œæˆ
      </button>
    </view>

    <!-- é€šç”¨æ“ä½œ -->
    <button class="btn btn-primary btn-block" bindtap="onContactOther">
      è”ç³»{{userType === 'coach' ? 'å­¦å‘˜' : 'æ•™ç»ƒ'}}
    </button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <view class="empty-state-icon">âŒ</view>
    <view class="empty-state-text">è¯¾ç¨‹ä¸å­˜åœ¨</view>
    <button class="btn btn-primary" bindtap="wx.navigateBack">è¿”å›</button>
  </view>
</view> 