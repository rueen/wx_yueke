<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- çº¦è¯¾è¡¨å• -->
  <view class="booking-form" wx:else>
    <!-- ç”¨æˆ·é€‰æ‹© -->
    <view class="form-section" wx:if="{{!fromUserDetail}}">
      <view class="section-title">é€‰æ‹©{{targetType === 'coach' ? 'æ•™ç»ƒ' : 'å­¦å‘˜'}}</view>
      <view class="user-list">
        <view 
          class="user-item {{selectedUserId === item.id ? 'selected' : ''}}"
          wx:for="{{availableUsers}}"
          wx:key="id"
          bindtap="onSelectUser"
          data-id="{{item.id}}"
        >
          <image class="user-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="user-info">
            <text class="user-name">{{item.nickname}}</text>
            <text class="user-desc" wx:if="{{item.specialty}}">{{item.specialty.join(' Â· ')}}</text>
            <text class="user-desc" wx:elif="{{item.coursesLeft}}">å‰©ä½™{{item.coursesLeft}}è¯¾æ—¶</text>
          </view>
          <view class="select-icon" wx:if="{{selectedUserId === item.id}}">âœ“</view>
        </view>
      </view>
    </view>

    <!-- å·²é€‰ç”¨æˆ·æ˜¾ç¤º -->
    <view class="form-section" wx:if="{{selectedUser}}">
      <view class="section-title">çº¦è¯¾å¯¹è±¡</view>
      <view class="selected-user">
        <image class="user-avatar" src="{{selectedUser.avatar}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="user-name">{{selectedUser.nickname}}</text>
          <text class="user-desc" wx:if="{{selectedUser.specialty}}">{{selectedUser.specialty.join(' Â· ')}}</text>
        </view>
      </view>
    </view>

    <!-- æ—¶é—´é€‰æ‹© -->
    <view class="form-section">
      <view class="section-title">é€‰æ‹©æ—¶é—´</view>
      
      <view class="time-picker-group">
        <view class="picker-item">
          <text class="picker-label">æ—¥æœŸ</text>
          <picker 
            mode="date" 
            value="{{selectedDate}}" 
            bindchange="onDateChange"
            start="{{selectedDate}}"
          >
            <view class="picker-value">
              {{selectedDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}
            </view>
          </picker>
        </view>

        <view class="picker-item">
          <text class="picker-label">æ—¶é—´</text>
          <picker 
            range="{{availableTimes}}" 
            value="{{selectedTime}}" 
            bindchange="onTimeChange"
          >
            <view class="picker-value">
              {{selectedTime || 'è¯·é€‰æ‹©æ—¶é—´'}}
            </view>
          </picker>
        </view>

        <view class="picker-item">
          <text class="picker-label">æ—¶é•¿</text>
          <picker 
            range="{{['30åˆ†é’Ÿ', '60åˆ†é’Ÿ', '90åˆ†é’Ÿ', '120åˆ†é’Ÿ']}}" 
            range-key="text"
            value="{{duration === 30 ? 0 : duration === 60 ? 1 : duration === 90 ? 2 : 3}}"
            bindchange="onDurationChange"
          >
            <view class="picker-value">
              {{duration}}åˆ†é’Ÿ
            </view>
          </picker>
        </view>
      </view>
    </view>

    <!-- è¯¾ç¨‹ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">è¯¾ç¨‹ä¿¡æ¯</view>
      
      <view class="input-group">
        <text class="input-label">ä¸Šè¯¾åœ°ç‚¹ *</text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥ä¸Šè¯¾åœ°ç‚¹" 
          value="{{location}}" 
          bindinput="onLocationInput"
        />
      </view>

      <view class="input-group">
        <text class="input-label">å¤‡æ³¨è¯´æ˜</text>
        <textarea 
          class="textarea" 
          placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼Œå¦‚ç‰¹æ®Šè¦æ±‚ã€æ³¨æ„äº‹é¡¹ç­‰" 
          value="{{remark}}" 
          bindinput="onRemarkInput"
          maxlength="200"
        />
      </view>
    </view>

    <!-- çº¦è¯¾é¢„è§ˆ -->
    <view class="form-section" wx:if="{{selectedUser && selectedDate && selectedTime}}">
      <view class="section-title">çº¦è¯¾é¢„è§ˆ</view>
      <view class="booking-preview">
        <view class="preview-item">
          <text class="preview-label">å¯¹è±¡ï¼š</text>
          <text class="preview-value">{{selectedUser.nickname}}</text>
        </view>
        <view class="preview-item">
          <text class="preview-label">æ—¶é—´ï¼š</text>
          <text class="preview-value">{{selectedDate}} {{selectedTime}}</text>
        </view>
        <view class="preview-item">
          <text class="preview-label">æ—¶é•¿ï¼š</text>
          <text class="preview-value">{{duration}}åˆ†é’Ÿ</text>
        </view>
        <view class="preview-item" wx:if="{{location}}">
          <text class="preview-label">åœ°ç‚¹ï¼š</text>
          <text class="preview-value">{{location}}</text>
        </view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
      <button 
        class="btn btn-primary btn-block {{isSubmitting ? 'btn-disabled' : ''}}" 
        bindtap="onSubmit"
        loading="{{isSubmitting}}"
      >
        {{isSubmitting ? 'å‘é€ä¸­...' : 'å‘èµ·çº¦è¯¾è¯·æ±‚'}}
      </button>
    </view>

    <!-- æ¸©é¦¨æç¤º -->
    <view class="tips-section">
      <view class="tip-item">
        <text class="tip-icon">ğŸ’¡</text>
        <text class="tip-text">çº¦è¯¾è¯·æ±‚å‘é€åï¼Œå¯¹æ–¹ç¡®è®¤å³å¯æˆåŠŸçº¦è¯¾</text>
      </view>
      <view class="tip-item">
        <text class="tip-icon">â°</text>
        <text class="tip-text">å»ºè®®æå‰1å¤©ä»¥ä¸Šå‘èµ·çº¦è¯¾è¯·æ±‚</text>
      </view>
    </view>
  </view>
</view> 